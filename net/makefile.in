#
# @package_copyright@
#
# @configure_input@
#

.POSIX :

.SUFFIXES :
A = .@LIBEXT@
O = .@OBJEXT@
E = @EXEEXT@
.SUFFIXES : .c .i $O $A

#
# Paths for supporting headers and libraries.
#
top_srcdir = @top_srcdir@
abs_srcdir = @abs_srcdir@
SNERT_TARDIR	= @snert_tardir@
SNERT_INCDIR	= @snert_incdir@
SNERT_LIBDIR	= @snert_libdir@

LIB	= $(SNERT_LIBDIR)/@PACKAGE_TARNAME@$A
BAK	= $(SNERT_LIBDIR)/@PACKAGE_TARNAME@.bak
TGZ	= $(SNERT_TARDIR)/@PACKAGE_TARNAME@-@PACKAGE_VERSION@.tgz

CC		= @CC@
CC_E	= @CC_E@
CC_O	= @CC_O@
CFLAGS	= ${CFLAGS_PREFIX} @CFLAGS@
LDFLAGS	= ${LDFLAGS_PREFIX} @LDFLAGS@
LIBS	= ${LIBS_PREFIX} @LIBS@


XARGSI	= @XARGSI@
RANLIB	= @RANLIB@
ARCHIVE	= @ARCHIVE@
COMPILE	= @COMPILE@

LIBSNERT = @LIBSNERT@
LIB_RT = @HAVE_LIB_RT@
LIB_WS2_32 = @HAVE_LIB_WS2_32@
LIB_IPHLPAPI = @HAVE_LIB_IPHLPAPI@

#######################################################################

#%$O : %.c
.c$O :
	$(COMPILE)

#(%) : %
#	$(ARCHIVE)$*

#%$E : %.c
.c$E :
	$(CC) $(CFLAGS) $(LDFLAGS) $(CC_E)$*$E $< $(LIBSNERT) $(LIBS)

#%$E : %$O
$O$E :
	$(LD) $(LDFLAGS) $(CC_E)$*$E $*$O $(LIBSNERT) $(LIBS)

.c.i:
	${CC} -E ${CFLAGS} $*.c >$*.i

#######################################################################

OBJS =  getRFC2821DateTime$O formatIP$O isRFC2606$O network$O networkGetMyDetails$O \
	parseIPv6$O isReservedIPv4$O isReservedIPv6$O isReservedIP$O ipinclient$O \
	reverse$O pdq$O spanIP$O findIP$O dnsList$O server$O http$O


.MAIN : build

all: build

build: title add-lib ipinclient$E findIP$E formatIP$E

add-lib: ${OBJS}
	@echo
	ar rc ${LIB} ${OBJS}
	$(RANLIB) $(LIB)
	@echo

clean : title
	-rm -f *.o *.obj *.i *.map *.tds *.TR2 *.stackdump core *.core core.* *.log

distclean: clean
	-rm -f ipinclient$E pdq$E findIP$E formatIP$E server$E geturl$E
	-rm makefile

title :
	@echo
	@echo '***************************************************************'
	@echo '==> '${abs_srcdir}
	@echo '***************************************************************'
	@echo

${top_srcdir}/util/DebugMalloc.o : ${top_srcdir}/util/DebugMalloc.c
	cd ${top_srcdir}/util ; make DebugMalloc.o

debug : ${top_srcdir}/util/DebugMalloc.o
	make CFLAGS_PREFIX='-I${top_srcdir}' LIBS_PREFIX='${top_srcdir}/util/DebugMalloc.o' build

#add-lib:
#	@echo
#	for obj in $(OBJS); do $(ARCHIVE); done
#	$(RANLIB) $(LIB)
#	@echo

lint: title
	-splint -D_REENTRANT -U__WIN32__ -I${SNERT_INCDIR} +posixlib +boolint *.c

findIP$E: findIP.c
	${CC} -DTEST ${CFLAGS} ${LDFLAGS} ${CC_E}findIP$E findIP.c  $(LIBSNERT) ${LIBS}

ipinclient$E: ipinclient.c
	${CC} -DTEST ${CFLAGS} ${LDFLAGS} ${CC_E}ipinclient$E ipinclient.c  $(LIBSNERT) ${LIBS}

ipinclient$O : ipinclient.c
	${CC} ${CFLAGS} -c ipinclient.c

pdq$E : pdq.c
	${CC} -DTEST ${CFLAGS} ${LDFLAGS} ${CC_E}pdq$E pdq.c $(LIBSNERT) ${LIBS} ${LIB_RT} ${LIB_WS2_32} ${LIB_IPHLPAPI}

formatIP$E: formatIP.c
	${CC} -DTEST ${CFLAGS} ${LDFLAGS} ${CC_E}formatIP$E formatIP.c  $(LIBSNERT) ${LIBS} ${LIB_WS2_32}

server$E : server.c
	${CC} -DTEST ${CFLAGS} ${LDFLAGS} ${CC_E}server$E server.c $(LIBSNERT) ${LIBS} ${LIB_RT} ${LIB_WS2_32} ${LIB_IPHLPAPI}

geturl$E : ../include/net/http.h http.c
	${CC} -DTEST ${CFLAGS} ${LDFLAGS} ${CC_E}geturl$E http.c $(LIBSNERT) ${LIBS} ${LIB_RT} ${LIB_WS2_32} ${LIB_IPHLPAPI}

# Not ready
#dnspkt$E : dnspkt.c
#	${CC} -DTEST ${CFLAGS} ${LDFLAGS} ${CC_E}dnspkt$E dnspkt.c $(LIBSNERT) ${LIBS} ${LIB_RT} ${LIB_WS2_32} ${LIB_IPHLPAPI}

